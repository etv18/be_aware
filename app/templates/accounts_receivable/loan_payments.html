{% extends 'layout.html' %}

{% block title %}Loan Payments{% endblock %}

{% block content %}

    <div class="container w-100">

        <h2>Loan Payments</h2>
        <div class="d-flex justify-content-start gap-1 flex-wrap flex-md-nowrap mt-2">
            <div class="d-flex gap-1 w-100 align-items-center" style="max-width: 320px;">
                <div class="w-100 w-md-auto mt-md-0" style="max-width: 320px;">
                    <input type="text" class="form-control" id="filter-byfiled-input-id" placeholder="Enter some text...">
                </div>
            </div>
            <div class="d-flex gap-1 w-100" style="max-width: 350px;">
                <div class="w-100 w-md-auto mt-md-0">
                    <input type="text" class="form-control" id="filter-bytime-input-id" placeholder="Select a time frame">
                </div>
                <button type="button" class="btn btn-outline-success" id="btn-search-id"><i class="bi bi-search"></i></button>
            </div>
        </div>
        
        <div class="table-responsive overflow-y-auto border rounded-3 mt-1" style="max-height: 457px;">
            <table class="table table-striped  table-hover">
                <thead class="sticky-top">
                    <tr>
                    <th scope="col"># Id</th>
                    <th scope="col">Loan PMT Cod.</th>
                    <th scope="col">Amount</th>
                    <th scope="col">Is Cash</th>
                    <th scope="col">Loan Cod. (Owner)</th>
                    <th scope="col">Bank Account</th>
                    <th scope="col">Create at</th>
                    </tr>
                </thead>
                
                <tbody id="loan-payments-table-body-id">
                  {% for payment in loan_payments %}
                    <tr>
                        <th scope="row">{{ payment.id }}</th>
                        <td>{{ payment.code }}</td>
                        <td>{{ format_amount(payment.amount) }}</td>
                        <td>{{ 'YES' if payment.is_cash else 'NO'}}</td>
                        <td>{{ payment.loan.code if payment.loan else '-'}}</td>
                        <td>{{ payment.bank_account.nick_name or '-' }}</td>
                        <td>{{ payment.created_at | format_datetime("EEE, dd MMM yyyy hh:mm a") }}</td>
                    </tr>
                  {% endfor %} 
                </tbody>
            </table>
        </div>

        <section>
            <div class="d-flex flex-column">
                <label id="lbl-total">Total This Month: ${{ total_amount(loan_payments) }}</label>
            </div>
        </section>
    </div>

    <div id="stats-container">
        <div class="d-flex justify-content-center my-2">
            <div class="d-flex justify-content-cente w-100" style="max-width: 320px;">
            <div class="border-top border-start border-end border-bottom rounded-3 p-3 w-100">
                <h5 class="mb-3 text-light">Select a year for the report</h5>
            
                <select class="form-select dark-select" id="year-select">
                    {% for year in years %}    
                        <option value="{{ year }}">{{ year }}</option>
                    {% endfor %}
                </select>
            </div>
            </div>
        </div>

        <div class="border rounded-3 w-100 p-2">
            <h3 class="text-center" id="chart-title">Loan Payments Stats</h3>

            <div class="chart-container">
                <canvas id="yearly-stats"></canvas>
            </div>
        </div>
        <input  type="hidden" name="" id="yearly-single-model-report-endpoint" value="{{ url_for('stats.yearly_single_model_report' ) }}">
    </div>
    
    <input type="hidden" name="" id="filter-data-endpoint" value="{{ url_for('accounts_receivable.filter_loans_payments_all' ) }}">
    
    
    <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@5/dark.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <script src="{{ url_for('static', filename='scripts/utils/utils.js' ) }}"></script>
    <script type="module" src="{{ url_for('static', filename='scripts/utils/numericHandling.js' ) }}"></script>
    <script type="module" src="{{ url_for('static', filename='scripts/utils/asyncHanlding.js' ) }}"></script>
    <script type="module" src="{{ url_for('static', filename='scripts/accounts_receivable/loan_payments/filterData.js' ) }}"></script>
    <script type="module" src="{{ url_for('static', filename='scripts/accounts_receivable/loan_payments/stats.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='scripts/utils/generateChart.js' ) }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% endblock %}